<!DOCTYPE html>
<!--[if IE]>
<meta http-equiv="X-UA-Compatible" content="IE=100" />
<style type="text/css">
/* IE CSS HERE */
<style>
<![endif]-->

<html id="top">

<head>

<title>{{ page.title }}</title>
<meta name="author" content="Graham Macphee" />
<meta name="description" content="I tend to think about puppies, pizza and equality. I enjoy being creative: writing, photography, guitar, ukulele and singing occasionally. I'm quiet and thoughtful, and like nature and quiet nights. I'm interested in a combination of technology, design, psychology and sociology." />
<meta name="keywords" content="I tend to think about puppies, pizza and equality. I enjoy being creative: writing, photography, guitar, ukulele and singing occasionally. I'm quiet and thoughtful, and like nature and quiet nights. I'm interested in a combination of technology, design, psychology and sociology." />
<meta charset="utf-8">
<link rel="canonical" href="{{ site.url }}{{ page.url }}" />
<link rel="alternate" type="application/atom+xml" title="{{ site.name }}" href="{{ site.baseurl }}/atom.xml" />
<meta property="og:title" content="{{ page.title }}">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ site.baseurl }}/{{ page.path }}">
<meta property="og:site_name" content="Graham Macphee">
<meta property="og:description" content="I tend to think about puppies, pizza and equality. I enjoy being creative: writing, photography, guitar, ukulele and singing occasionally. I'm quiet and thoughtful, and like nature and quiet nights. I'm interested in a combination of technology, design, psychology and sociology.">
<meta property="twitter:account_id" content="87261538" /> <!-- Twitter ID, currently for @gmph -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#8B67FF">

{% include httpsredirect.html %}

<link rel="shortcut icon" href="{{ site.baseurl }}/res/img/ptlogooutline.png">
<link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400' rel='stylesheet' type='text/css'>
<link href="{{ site.baseurl }}/res/css/main.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

{% include fbmeta.html %}
{% include twittermeta.html %}

</head>

<body>

		<div class="posttabs">
			<div class="content">
				<a href="{{ site.baseurl }}/articles" class="purple">Articles</a>
				<a href="{{ site.baseurl }}/notes" class="purple">Notes</a>
		        <a href="{{ site.baseurl }}/portfolio" class="purple">Portfolio</a>
				<a href="https://twitter.com/gmph" target="_blank" class="twitter">Twitter</a>
			</div>
	    </div>

		<div class="block landing">

			<h1 class="nomo"><span class="title">{{ page.heading }}</span><span class="cursor blink">&#124;</span></h1>

			<h1 class="moon"><span class="mobile-title">{{ page.heading }}</span></h1>

			{% if page.private %}
			<h2 class="subheading">This article is currently a private draft.</h2>
			{% else if page.subheading %}
			<h2 class="subheading">{{ page.subheading }}</h2>
			{% endif %}

			<!-- <span class="littleline"></span> -->

			{{ content }}

		</div>

		<!-- <a href="#top"><div class="footerimg"><div class="img"></div></div></a> -->

</body>


<script language="javascript">

	var designsManager = function($){

		function getAndDisplayDesigns(){
			$.get('https://api.dribbble.com/v1/users/gmph/shots?access_token=0c812957ccb3bc8a857fad33c03f91f3ce4661ab199210d893649b7a920aa51b', function(designs){
				var listOfDesigns = [];
				for (var i = 0; i < designs.length && i < 4; i++){
					listOfDesigns.push({
						'id' : designs[i].id,
						'title' : designs[i].title,
						'url' : designs[i].html_url,
						'image' : designs[i].images.hidpi || designs[i].images.normal,
					});
				}
				return displayDesigns(listOfDesigns);
			});
		}

		function displayDesigns(listOfDesigns){
			var $designs = $('.designs-container');
			for (var i = 0; i < listOfDesigns.length; i++){
				$designs.append(getDesignElementFromDesignItem(listOfDesigns[i]));
			}
		}

		function getDesignElementFromDesignItem(design){
			var $design = $('<a>')
				.addClass('design-item')
				.attr({
					'href' : design.url,
					'target' : '_blank',
					'data-id' : design.id,
					'title' : design.title,
					'alt' : design.title
				});
			var $image = $('<img>')
				.attr({
					'title' : design.title,
					'alt' : design.title,
					'src' : design.image
				});
			$design.append($image);
			return $design;
		}

		return {
			displayDesigns : getAndDisplayDesigns,
		}

	}($)

	var musicManager = function($){

		function displaySongWithDescriptionInElement(songWithNameArtistImageUrl,description,element){
			var song = songWithNameArtistImageUrl;
			var $songContainer = $('<div class="song-container"></div>');
			var songString = "";
			var $songImage;
			if (song['name'] != undefined){
				songString = song['name'];
				if (song['artist'] != undefined){
					songString += " by " + song['artist'];
				}
				if (song['image'] != undefined){
					$songImage = $('<img class="song-image" src="'+song['image']+'"/>');
					$songContainer.append($songImage);
				}
				var $song = $('<a href="'+song.url+'" target="_blank"></a>').append($songContainer.append(($('<div class="song-info"></div>').append($('<div class="song-description">'+description+'</div>'))).append($('<div class="song-text">'+songString+'</div>'))));
				$(element).after($song);
				$(element).remove();
			} else {
				$(element).remove();
			}
		}

		function displayMostPlayedSongThisWeek(){
			$.get('https://ws.audioscrobbler.com/2.0/?method=user.gettoptracks&user=grahammacphee&period=1month&api_key=5f134f063744307ee6f126ac2c480fab&format=json', function(data){
				var mostPlayedSong = {};
				try {
					mostPlayedSong['name'] = data.toptracks.track[0].name;
				} catch (e){
					// No name
					mostPlayedSong['name'] = null;
				}
				try {
					mostPlayedSong['artist'] = data.toptracks.track[0].artist.name;
				} catch (e){
					// No artist
					mostPlayedSong['artist'] = null;
				}
				try {
					mostPlayedSong['image'] = data.toptracks.track[0].image[data.toptracks.track[0].image.length-1]['#text'];
				} catch (e){
					// No image
					mostPlayedSong['image'] = null;
				}
				try {
					mostPlayedSong['url'] = data.toptracks.track[0].url;
				} catch (e){
					// No name
					mostPlayedSong['url'] = null;
				}
				return displaySongWithDescriptionInElement(mostPlayedSong,'Most played this month',$('.most-listened'));
			})
		}

		return {
			displayMostPlayedThisWeek : displayMostPlayedSongThisWeek,
		}

	}($)

	var locationManager = function($){

		var $locationContainer = $('#latestLocation');

		var randomString = "AIzaSyDQJOQNtvd0-mEKu-2veoiz3QMnLf01kis";
		var mapZoomLevel = "10";

		var locationDataText;
		var locationData = [];
		var eventLocationDataProcessed = new Event('locationDataProcessed');

		function init(callback){
			getDataFromTextFile("https://dl.dropboxusercontent.com/u/17016249/Data/location.txt");
			if (callback){
				document.addEventListener('locationDataProcessed', callback, false);
			}
		}

		function getParameterByName(name, url) {
		    if (!url) url = window.location.href;
		    name = name.replace(/[\[\]]/g, "\\$&");
		    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		        results = regex.exec(url);
		    if (!results) return null;
		    if (!results[2]) return '';
		    return decodeURIComponent(results[2].replace(/\+/g, " "));
		}

	    function getDataFromTextFile(file){
	        var rawFile = new XMLHttpRequest();
	        rawFile.open("GET", file, true);
	        rawFile.onreadystatechange = function (){
	            if(rawFile.readyState === 4){
	                if(rawFile.status === 200 || rawFile.status == 0){
	                    locationDataText = rawFile.responseText;
						processLocationData();
	                }
	            }
	        }
	        rawFile.send(null);
	    }

		function processLocationData(){
			var locationDataTextSplit = locationDataText.split("/%/");
			locationDataTextSplit.pop();
			for (i=0;i<locationDataTextSplit.length;i++){
				locationData.push(JSON.parse(locationDataTextSplit[i]));
			}
			document.dispatchEvent(eventLocationDataProcessed);
		}

		function displayLatestLocationName(){
			try {
				var numberOfLocations = locationData.length-1;
				var latestLocation = locationData[numberOfLocations];
				var latestValidName = ' <a href="'+latestValidURL+'" target="_blank"><div class="name">' + latestLocation.name + "</div></a>";
				var latestValidURL = latestLocation.linkURL;
				var latestMapCenter = getParameterByName("center",locationData[numberOfLocations].mapImageURL);
				$('#map').attr('src','https://www.google.com/maps/embed/v1/view?center='+latestMapCenter+'&zoom='+mapZoomLevel+'&key='+randomString);
				updateText = '<a href="'+latestValidURL+'" target="_blank"><div class="region">' + latestLocation.name + "</div></a>" + '<a href="'+latestValidURL+'" target="_blank"><!--<div class="date">' + latestLocation.date.slice(0,-2) + latestLocation.date.substring(latestLocation.date.length-2).toLowerCase() + '</div>--></a>';
				$locationContainer.html(updateText);
			} catch (e){
				$locationContainer.remove();
			}

		}

		function displayLatestTrip(description,element){
			try {
				var $element = $(element);
				var latestLocation = locationData[locationData.length-1];

				var $locationContainer;
				var $mapImage = $('<div class="location-map-container"></div>').append($('<img class="location-map" src="'+latestLocation.mapImageURL.replace('http://', 'https://')+'&key='+randomString+'"/>'));
				var $locationDescription = $('<div class="song-description">'+description+'</div>');

				var $locationContainer = $('<a href="'+latestLocation.linkURL+'" target="_blank"></a>').append($('<div class="location-container"></div>').append($mapImage).append(($('<div class="location-info"></div>').append($('<div class="location-description">'+description+'</div>'))).append($('<div class="location-name">'+latestLocation.name+'</div>'))));

				$element.after($locationContainer);
				$element.remove();
			} catch (e){
				$(element).remove();
			}
		}

		return {
			init : init,
			displayLatestLocationName : displayLatestLocationName,
			displayLatestTrip : displayLatestTrip,
		}

	}($);

	var titleVariation = 0;

    $(document).ready(function(){
    	initLoadingState();
    	attachEvents();
		setStyling();
    	animLoadingState();
    	navigateToHashCategory();
    	musicManager.displayMostPlayedThisWeek();
    	locationManager.init(function(){
			locationManager.displayLatestTrip('Recent trip',$('.latest-trip'));
		});
		designsManager.displayDesigns();
	});

    function initLoadingState(){
    	$('.block, .posttabs, .footerimg').css('opacity','0');
	    $('body').css('overflow-y','hidden');
	    $('.loadimg').css('opacity','0');
    }

    function animLoadingState(){
    	setTimeout(function(){
    		$('.loadimg').css('opacity','0');
    		setTimeout(function(){
	    		$('.loadimg').css('opacity','0');
	    		setTimeout(function(){
		    		$('.block, .posttabs, .footerimg').css('opacity','1');
		    		$('body').css('overflow-y','scroll');
					setTimeout(function(){
						startLoopTitle();
					},3000);
		    	},400);
	    	},0);
    	},0);
    }

    function setStyling(){
    	$('.title').html('Graham Macphee');
		$('.cursor').addClass('blink');
    	$('a').each(function() {
		    if ($(this).find('img').length) {
		        $(this).css('border','none');
		    }
		});

		if ($(window).scrollTop() <= $('.postview').offset().top - 50){
			$('.posttabs').addClass('no-active');
			$('.posttab.home').addClass('active');
		} else {
			$('.posttabs').removeClass('no-active');
			$('.posttab.home').removeClass('active');
		}

		$('.postlist').each(function(){
			for (var i = 0; i < $(this).find('.postitem').length; i++){
				$(this).find('.postitem').eq(i).css('transition','.3s all ease-out '+(150*i)+'ms');
				$(this).find('.postitem').eq(i).css('-webkit-transition','.3s all ease-out '+(150*i)+'ms');
			}
		});
    }

    function navigateToHashCategory(){
    	var hash = location.hash.slice(1,-1);
    	$('.posttab[data-tab="'+hash+'"]').click();
    }

    function attachEvents(){

    	$(document).on('scroll',function(){
			if ($(window).scrollTop() <= $('.postview').offset().top - 100){
				$('.posttabs').addClass('no-active');
				$('.posttab.home').addClass('active');
			} else {
				$('.posttabs').removeClass('no-active');
				$('.posttab.home').removeClass('active');
			}
		});

    	$(document).on('click','.posttab',function(){
			var $activeTab = $(this);
			if (!$activeTab.hasClass('active') || $(window).scrollTop() <= 100){
				var category = $activeTab.attr('data-tab');
				var id = parseInt($activeTab.attr('data-id'));
				if (!$activeTab.hasClass('active')){
					$('.postlist').css({'opacity':'0','top':'15px'});
				}
				$('.posttab').removeClass('active before after');
				$activeTab.addClass('active');
				$('html,body').animate({
					"scrollTop" : $('.postlist[data-id="'+id+'"]').closest('.postview').offset().top - 17,
				},300);
				setTimeout(function(){
					$('.postlist').removeClass('active before after');
					$('.postlist.'+category).addClass('active');

					$('.posttab').each(function(){
						var $thisTab = $(this);
						if (parseInt($thisTab.attr('data-id')) < id){
							$thisTab.addClass('before');
							$('.postlist[data-id="'+$thisTab.attr('data-id')+'"]').addClass('before');
						} else if (parseInt($thisTab.attr('data-id')) > id){
							$thisTab.addClass('after');
							$('.postlist[data-id="'+$thisTab.attr('data-id')+'"]').addClass('after');
						}
					});


					$('.postlist').css({'opacity':'','top':''});
				},400);
			}
		});

		$(document).on( "touchstart", ".menubutton, .bigclose" , function(e) {
			e.preventDefault();
			controlMenu();
		} );

		$(document).on( "click", ".menubutton, .bigclose" , function() {
			controlMenu();
		} );

    }

    function controlMenu(){
		$('.menubutton').toggleClass('close');
		if ($('.menubutton').hasClass('close')){ // open menu
			openMenu();
		} else { // close menu
			closeMenu();
		}
	}

	function openMenu(){
		$('.block').addClass('menuopen');
		$('.menu').removeClass('closed');
		$('html,body').css('overflow','hidden');
	}

	function closeMenu(){
		$('.block').removeClass('menuopen');
		$('.menu').addClass('closed');
		$('html,body').css('overflow','auto');
	}

    function startLoopTitle(){
    	backspaceThis("Macphee".length,"is a designer.",0);
    }

	function animLoopTitle(){
		setTimeout(function(){
			if (titleVariation == 0){
				$('.title').html('Graham is a designer.');
				setTimeout(function(){
					typeReplace("is a designer.","writes code.");
				},500);
			} else if (titleVariation == 1){
				setTimeout(function(){
					typeReplace("writes code.","writes articles.");
				},500);
			} else if (titleVariation == 2){
				setTimeout(function(){
					typeReplace("writes articles.","takes photos.");
				},500);
			} else if (titleVariation == 3){
				setTimeout(function(){
					typeReplace("takes photos.","is a feminist.");
				},500);
			} else if (titleVariation == 4){
				setTimeout(function(){
					typeReplace("is a feminist.","Macphee");
				},500);
			} else if (titleVariation == 5){
				setTimeout(function(){
					typeReplace("Macphee","is a designer.");
				},500);
			}
		},2400);
	}

	function typeReplace(oldString,newString){
		var stepTo = (titleVariation+1) % 6;
		backspaceThis(oldString.length,newString,stepTo);
	}

	function backspaceThis(i,string,variation){
		if (i > 0){
			$('.cursor').removeClass('blink');
			setTimeout(function(){
				$('.title').html($('.title').text().slice(0,-1));
				backspaceThis(i-1,string,variation);
			},40);
		} else {
			setTimeout(function(){
				$('.cursor').addClass('blink');
			},400);
			setTimeout(function(){
				typeThis(string,1,variation);
			},700);
		}
	}

	function typeThis(string,i,variation){
		if (i <= string.length){
			$('.cursor').removeClass('blink');
			setTimeout(function(){
				$('.title').html($('.title').text() + string.slice(i-1,i));
				typeThis(string,i+1,variation);
			},110);
		} else {
			setTimeout(function(){
				$('.cursor').addClass('blink');
			},400);
			titleVariation = variation;
			// animLoopTitle();
		}
	}

	$(function() {
      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({
              scrollTop: (target.offset().top - 30)
		  	}, 400);
            return false;
          }
        }
      });
    });

</script>

</html>
